---
layout: post
title: "分布式-集群"
date: 2017-04-23
description: "分布式-集群"
tag: 分布式
---   



### 1.概念
        分布式是以缩短单个任务的执行时间来提升效率的，
        集群则是提高单位时间内执行的任务数来提升效果的
    
    EXP:
        如果一个任务由10个子任务组成，每个任务单独执行执行需要1个小时，则一台服务器上执行该任务需要10个小时.
        
    采用分布式方案：
        提供10台服务器，每天服务器只处理一个子任务，不考虑子任务之间的依赖关系，执行完成任务需要1个小时(典型的是Hadoop的Map/Reduce分布式计算模型)。
    
    采用集群方案：
        同样提供10台服务器，每台服务器都能独立处理这个任务。假设有10个任务同时到达，10个服务器将同时工作，10个小时后，10个任务同时完成，这样从整体上来看，还是1个小时内完成一个任务

### 2.集群概念：
        1.俩大关键特性：
            集群是一组协同工作的服务实体，用以提供比单一的服务实体更具有扩展性与可用性的服务平台。在客户端看来，一个集群就像是一个服务实体，但实际上集群是由一组服务实体组成。与单一服务相比，集群提供有俩个关键特性：
            可扩展性 — — 集群的性能不能限于单一的服务实体，新的服务实体可以动态的加入集群，从而增强集群的性能
            高可用性 — —  集群通过服务实体冗余使客户端免于轻易遇到out of servvice的警告。在集群中，同样的服务可以由多个服务实体提供。如果一个服务实体失败了，另一个服务实体会接管失败的服务实体。集群提供的从一个出错的服务实体恢复到另一个服务实体的功能增强了应用的可用性
        
        2.俩大能力
            负载均衡 — — 负载均衡能把任务比较均衡的分布到集群环境下的计算和网络资源
            错误恢复 — — 由于某种原因，执行某个任务的资源出现故障，另一服务实体中执行统一任务的资源接着完成任务。
        3.俩大技术
            集群地址 — — 集群由多个服务实体组成，集群客户端通过访问集群的集群地址获取集群内部各服务实体的功能。维护集群地址的设置被称为负载均衡器。负载均衡器内部负责管理各个服务实体的加入和退出，外部负责集群地址向内部服务实体地址的转换。
            内部通信 — — 为了能够协同工作，实现负载均衡和错误恢复，集群各实体间必须时常通信，比如负载均衡器对服务实体心跳测试信息，服务实体间任务执行上下文信息的通信.

### 4.集群分类(高可用集群、负载均衡集群、科学计算集群)
        1.高可用集群(High Avaliability Cluster)
            常见的就是2个节点做成的HA集群，常见的名称 双机热备 双机互备 双机；高可用集群解决的是保证用户的应用程序持续对外提供服务的能力。
        
        2.负载均衡集群(Load balance Cluster)
            负载均衡系统:集群中所有的节点处于活动状态，他们分摊系统的工作负载。一般Web服务器集群、数据库集群和应用服务集群都是这种类型
            负载均衡一般用于相应网络请求的网页服务器、数据库服务器。这种集群可以在接到请求时，检查接受请求较少，不繁忙的服务器，并把请求转到这些服务器上。
       
        3.科学计算集群(High Performance Computing Cluster)
          高性能计算集群，简称为HPC集群。这类集群致力于提供单个计算机所不能提供的强大的计算能力
          3.1.高性能计算分类：
               高吞吐量计算(High-throughput Computing)
               可以把它分为若干个并行的子任务，而且各个子任务彼此间没有什么关联。
          3.2.分布计算(Distributed Computing)
               另一类计算刚好和高吞吐计算相反，它虽然分为若干并行的子任务，但是子任务间很紧密，需要大量的数据交换。

### 3.分布式(集群)与集群的联系与区别
     1.分布式是指将不同的业务分布到不同的地方
     2.集群指的是将几台服务器集群中在一起，实现同一业务
     3.分布式中的每一个节点，都可以作为集群
     4.集群并一定就是分布式

### 4.基于redis实现分布式锁
        在多线程环境中，锁是实现共享资源互斥访问的重要机制，以保证任何时刻只有一个线程在访问共享资源。
        
        锁的基本原理是：
            用一个状态值表示锁，对锁的占用和释放通过状态值来标识，因此:基于redis实现的分布式锁主要依赖redis的SETNX命令和DEL命令，SETNX相当于上锁，DEL相当于释放锁。
        实现分析：
            锁对象主要有lock和unlock方法，在lock和unlock方法之间的代码(临界区)能够保证线程互斥访问。基于redis实现的Java分布式锁主要依赖的redis的SETNX和DEL名，SETNX相当于上锁，DEL相当于释放锁(unlock).安全可靠的分布式锁应该满足下面三个条件：
            1.互斥，不管任何时候，只有一个客户端能持有同一个锁
            2.不会死锁，最终一定会得到锁，即使持有锁的客户端对应的master节点宕机
            3.容错，至于大多数Redis节点正常工作，客户端应该能获取和释放锁
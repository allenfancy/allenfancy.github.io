---
layout: post
title: "分布式协议"
date: 2017-03-05
description: "一致性协议"
tag: 分布式
---   

### 1. 两阶段提交协议
1.基本概念：
> two-phase Commit (2pc):可以保证一个事务跨越多个节点时保持ACID的特性.
> 存在两类节点:协调者(Coordinator)和参与者(Participants)，协调者只有一个,参与者可以有多个.

2.运行过程:
> 1. 准备阶段:协调者询问参与者事务是否执行成功。
> 2. 提交阶段: 如果事务在每个参与者上都执行成功，协调者发送通知，让所有的参与者提交事务;否则，协调者通知所有的参与者回滚事务.

> NOTE: 准备阶段是所有的参与者已经执行了事务，但是未提交。在提交阶段，是事务的提交或回滚的操作.

3.存在的问题以及解决方案:
> 1. 参与者发生故障。解决方案：为事务设置超时时间，如果某个参与者一致不响应，那么任务事务执行失败.
> 2. 协调者发生故障。解决方案：将操作日志同步给备用协调者，后续让备用协调者代替工作.

----
### 2. 三阶段提价协议
1. 

-----
### 3.PAXOS协议
1. 基本概念
> 用于达成某种共识性问题，即对多个节点产生的值，该算法能保证值选出唯一一个值.三类节点:
> 1. 提议者(Proposer):提议一个值;
> 2. 接收者(Acceptor):对每个提议进行投票
> 3. 告知者(Learner):被告知投票的结果，不参与投票的过程

2. 执行过程
> 

3. 约束条件

> 1. 正确性：只有一个提案会生效.因为Paxos协议要求每个生效的提交被多个Acceptor接收，并且Acceptor不会接收俩个不同的提议，因此可以保证正确性
> 2. 可终止性：最后总会有提议生效.Paxos协议能让Proposer发送的提议朝着大多数Acceptor接收的那个提议靠拢,因此能够保证可终止性

----
### 4. Raft协议

1. 基本信息
> Raft 和 Paxos 类似，但是更容易理解，也更容易实现。
Raft 主要是用来竞选主节点。Follower、Candidate 和 Leader三种节点
2. 单个 Candidate 的竞选
> 1. Leader周期性发送心跳包给对应的Follower。每个 Follower 都设置了一个随机的竞选超时时间，一般为150ms~300ms，如果在这个时间内没有收到Leader的心跳包，就会变成Candidate，进入竞选阶段。
> 2. 节点A发起投票请求给其他节点，如果超过半数的协议的认同。A称为Leader。
> 3. A周期性的发送心跳。Follower收到心跳，重新计时。
3. 多个 Candidate 的竞选
4. 日志复制

-----
### 5. gossip协议